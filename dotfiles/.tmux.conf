# -*-conf-*-

#######################
### GENERAL SETTINGS ##
#######################

# Enable mouse control (clickable windows, panes, resizable panes)
set -g mouse on

# Increase scrollback buffer size
set -g history-limit 50000

# Display tmux messages for 4 seconds
set -g display-time 4000

# Refresh status bar more frequently for better responsiveness
set -g status-interval 5

# Focus events enabled for terminals that support them
set -g focus-events on

# Super useful when using "grouped sessions" and multi-monitor setup
setw -g aggressive-resize on

# Start window and pane numbering at 1
set -g base-index 1
setw -g pane-base-index 1

# Automatic windows renumbering
set -g renumber-windows on

# Don't rename windows automatically
set-option -g allow-rename off

# No delay for escape key press (important for vim)
set -sg escape-time 0

# Enable RGB colour if running in xterm
set -g default-terminal "xterm-256color"
set-window-option -g xterm-keys on

# True color support
set -ga terminal-overrides ",*256col*:Tc"

# Undercurl support
set -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'
set -as terminal-overrides ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'

# Update VSCODE variables from integrated terminal
set-option -ga update-environment 'VSCODE_GIT_ASKPASS_NODE VSCODE_GIT_ASKPASS_MAIN VSCODE_IPC_HOOK_CLI PATH GIT_ASKPASS'

# Address vim mode switching delay
set -s escape-time 0

# Increase tmux messages display duration
set -g display-time 4000

# Emacs key bindings in command prompt (status-left)
set -g status-keys emacs

#######################
### KEY BINDINGS ######
#######################

# Reload config file
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# Split panes using | and - (more intuitive)
bind '|' split-window -h -c "#{pane_current_path}"
bind '_' split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# Additional splits that stay in current path
bind % split-window -h -c "#{pane_current_path}"
bind : split-window -v -c "#{pane_current_path}"

# Create new window in current path
bind c new-window -c "#{pane_current_path}"

# Toggle between sessions
bind-key C-b switch-client -l

# Session management
bind C-c new-session
bind C-f command-prompt -p find-session 'switch-client -t %%'

# Window management
bind k confirm kill-window
bind K confirm kill-server
bind a last-window
bind space command-prompt -p index "select-window"

# Pane resizing
bind -r < resize-pane -L 5
bind -r > resize-pane -R 5
bind -r - resize-pane -D 5
bind -r + resize-pane -U 5

# Easier pane resizing with hjkl
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Quick pane selection with prefix + hjkl
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Use C-arrow keys without prefix to switch panes
bind -n C-Left select-pane -L
bind -n C-Right select-pane -R
bind -n C-Up select-pane -U
bind -n C-Down select-pane -D

# Command prompt
bind . command-prompt

# Toggle mouse
bind m set -g mouse \; display "Mouse: #{?mouse,ON,OFF}"

# Toggle synchronize panes
bind S set synchronize-panes \; display "Synchronize: #{?synchronize-panes,ON,OFF}"

# Break pane into new window
bind b break-pane -d

# Join pane from another window
bind j command-prompt -p "Join pane from: " "join-pane -h -s '%%'"

# Swap windows
bind -r "," swap-window -d -t -1
bind -r "." swap-window -d -t +1

# Create new window and prompt for name
bind C command-prompt -p "Name of new window: " "new-window -n '%%'"

# Rename current window
bind R command-prompt -I "#W" "rename-window '%%'"

# Rename current session
# bind '

#######################
### COPY MODE #########
#######################

# Use vi mode
setw -g mode-keys vi

# Copy mode bindings
bind P paste-buffer
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel

# Enter copy mode with prefix + [
bind [ copy-mode

# Search for previous error
bind-key e copy-mode \; send-keys "?error" C-m

# Better mouse wheel scrolling
bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'select-pane -t=; copy-mode -e; send-keys -M'"
bind -n WheelDownPane select-pane -t= \; send-keys -M
bind -n C-WheelUpPane select-pane -t= \; copy-mode -e \; send-keys -M
bind -T copy-mode-vi C-WheelUpPane send-keys -X halfpage-up
bind -T copy-mode-vi C-WheelDownPane send-keys -X halfpage-down

# Prefix highlight (shows when prefix is active)
# Add plugin section at end of file for this

# Quick layout switching
bind M-1 select-layout even-horizontal
bind M-2 select-layout even-vertical
bind M-3 select-layout main-horizontal
bind M-4 select-layout main-vertical
bind M-5 select-layout tiled

# Toggle status bar
bind T set-option -g status

#######################
### DESIGN CHANGES ####
#######################

# Panes
set -g pane-border-style bg=colour235,fg=colour238
set -g pane-active-border-style bg=colour236,fg=colour51

# Statusbar
set -g status-position bottom
set -g status-bg colour234
set -g status-fg colour137
set -g status-style dim
set -g status-justify left
set -g status-left-length 30
set -g status-right-length 50
set -g status-left '#[fg=green,bold](#S) #[fg=cyan]#(whoami)@#h '
set -g status-right '#[fg=colour233,bg=colour241,bold] %d/%m #[fg=colour233,bg=colour245,bold] %H:%M:%S '

# Window status
setw -g window-status-current-style fg=colour81,bg=colour238,bold
setw -g window-status-current-format ' #I#[fg=colour250]:#[fg=colour255]#W#[fg=colour50]#F '

setw -g window-status-style fg=colour138,bg=colour235,none
setw -g window-status-format ' #I#[fg=colour237]:#[fg=colour250]#W#[fg=colour244]#F '

setw -g window-status-bell-style fg=colour255,bg=colour1,bold

# Messages
set -g message-style fg=colour232,bg=colour166,bold
set -g message-command-style fg=blue,bg=black

# Window mode
setw -g mode-style fg=colour0,bg=colour6

# Clock mode
setw -g clock-mode-colour colour135

# Activity monitoring
set-option -g visual-activity off
set-option -g visual-bell off
set-option -g visual-silence off
set-window-option -g monitor-activity off
set-option -g bell-action none

#######################
### HELP ##############
#######################

# Help screen: list keys in new pane
bind-key ? split-window -h 'exec tmux list-keys | less'

#######################
### PLUGINS ###########
#######################

# TPM (Tmux Plugin Manager)
# Install TPM first: git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
# Install plugins: prefix + I
# Update plugins: prefix + U
# Remove plugins: prefix + alt + u

# set -g @plugin 'tmux-plugins/tpm'
# set -g @plugin 'tmux-plugins/tmux-sensible'
# set -g @plugin 'tmux-plugins/tmux-resurrect'        # Save/restore sessions
# set -g @plugin 'tmux-plugins/tmux-continuum'        # Auto-save sessions
# set -g @plugin 'tmux-plugins/tmux-yank'             # Better copy to system clipboard
# set -g @plugin 'tmux-plugins/tmux-copycat'          # Better search in copy mode
# set -g @plugin 'tmux-plugins/tmux-open'             # Open highlighted file/URL
# set -g @plugin 'tmux-plugins/tmux-pain-control'     # Better pane control bindings
# set -g @plugin 'sainnhe/tmux-fzf'                   # Fuzzy finder integration

# Plugin settings
# set -g @resurrect-capture-pane-contents 'on'
# set -g @continuum-restore 'on'
# set -g @continuum-save-interval '15'

# Initialize TPM (keep this line at the very bottom)
# run '~/.tmux/plugins/tpm/tpm' command-prompt -I "#S" "rename-session '%%'"

# Kill pane without confirmation
bind x kill-pane

# Easier and faster switching between next/prev window
bind C-p previous-window
bind C-n next-window

# Move window to different position
bind M command-prompt -p "Move window to position: " "move-window -t '%%'"

#######################
### COPY MODE #########
#######################

# Use vi mode
setw -g mode-keys vi

# Copy mode bindings
bind P paste-buffer
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel

# Enter copy mode with prefix + [
bind [ copy-mode

# Search for previous error
bind-key e copy-mode \; send-keys "?error" C-m

# Better mouse wheel scrolling
bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'select-pane -t=; copy-mode -e; send-keys -M'"
bind -n WheelDownPane select-pane -t= \; send-keys -M
bind -n C-WheelUpPane select-pane -t= \; copy-mode -e \; send-keys -M
bind -T copy-mode-vi C-WheelUpPane send-keys -X halfpage-up
bind -T copy-mode-vi C-WheelDownPane send-keys -X halfpage-down

#######################
### DESIGN CHANGES ####
#######################

# Panes
set -g pane-border-style bg=colour235,fg=colour238
set -g pane-active-border-style bg=colour236,fg=colour51

# Statusbar
set -g status-position bottom
set -g status-bg colour234
set -g status-fg colour137
set -g status-style dim
set -g status-justify left
set -g status-left-length 30
set -g status-right-length 50
set -g status-left '#[fg=green,bold](#S) #[fg=cyan]#(whoami)@#h '
set -g status-right '#[fg=colour233,bg=colour241,bold] %d/%m #[fg=colour233,bg=colour245,bold] %H:%M:%S '

# Window status
setw -g window-status-current-style fg=colour81,bg=colour238,bold
setw -g window-status-current-format ' #I#[fg=colour250]:#[fg=colour255]#W#[fg=colour50]#F '

setw -g window-status-style fg=colour138,bg=colour235,none
setw -g window-status-format ' #I#[fg=colour237]:#[fg=colour250]#W#[fg=colour244]#F '

setw -g window-status-bell-style fg=colour255,bg=colour1,bold

# Messages
set -g message-style fg=colour232,bg=colour166,bold
set -g message-command-style fg=blue,bg=black

# Window mode
setw -g mode-style fg=colour0,bg=colour6

# Clock mode
setw -g clock-mode-colour colour135

# Activity monitoring
set-option -g visual-activity off
set-option -g visual-bell off
set-option -g visual-silence off
set-window-option -g monitor-activity off
set-option -g bell-action none

#######################
### HELP ##############
#######################

# Help screen: list keys in new pane
bind-key ? split-window -h 'exec tmux list-keys | less'
