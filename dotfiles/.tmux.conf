# -*-conf-*-

#######################
### GENERAL SETTINGS ###
#######################

set -g mouse on
set -g history-limit 50000
set -g display-time 4000
set -g status-interval 5
set -g focus-events on
setw -g aggressive-resize on
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on
set -g allow-rename off

# Make key sequences snappy (Vim/Emacs friendly)
set -sg escape-time 0

# Truecolor + good default terminal for tmux
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ',*:Tc'

# Undercurl support (if your terminal supports it)
set -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'
set -as terminal-overrides ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'

# Better xterm key handling when not using tmux-256color terminfo
set -g xterm-keys on

# Pass through useful env vars (add more as needed)
set -ga update-environment 'VSCODE_GIT_ASKPASS_NODE VSCODE_GIT_ASKPASS_MAIN VSCODE_IPC_HOOK_CLI PATH GIT_ASKPASS COLORTERM'

#######################
### KEY BINDINGS ######
#######################

# Reload config
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# Splits keep current path
bind '|' split-window -h -c "#{pane_current_path}"
bind '_' split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %
bind % split-window -h -c "#{pane_current_path}"
bind : split-window -v -c "#{pane_current_path}"

# New window in current path
bind c new-window -c "#{pane_current_path}"

# Toggle between last sessions
bind-key C-b switch-client -l

# Session / window mgmt
bind C-c new-session
bind C-f command-prompt -p find-session 'switch-client -t %%'
bind k confirm kill-window
bind K confirm kill-server
bind a last-window
bind space command-prompt -p index "select-window"

# Pane resizing
bind -r < resize-pane -L 5
bind -r > resize-pane -R 5
bind -r - resize-pane -D 5
bind -r + resize-pane -U 5
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Pane selection (hjkl)
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Switch panes with Ctrl+Arrows (no prefix)
bind -n C-Left  select-pane -L
bind -n C-Right select-pane -R
bind -n C-Up    select-pane -U
bind -n C-Down  select-pane -D

# Prompt & toggles
bind . command-prompt
bind m set -g mouse \; display "Mouse: #{?mouse,ON,OFF}"
bind S set synchronize-panes \; display "Synchronize: #{?synchronize-panes,ON,OFF}"

# Break/join/swap/rename
bind b break-pane -d
bind j command-prompt -p "Join pane from: " "join-pane -h -s '%%'"
bind -r , swap-window -d -t -1
bind -r . swap-window -d -t +1
bind C command-prompt -p "Name of new window: " "new-window -n '%%'"
bind R command-prompt -I "#W" "rename-window '%%'"

# Kill pane without confirmation
bind x kill-pane

# Fast prev/next window
bind C-p previous-window
bind C-n next-window

# Move window
bind M command-prompt -p "Move window to position: " "move-window -t '%%'"

#######################
### COPY MODE #########
#######################

setw -g mode-keys vi
bind P paste-buffer
bind-key -T copy-mode-vi v  send-keys -X begin-selection
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind-key -T copy-mode-vi y  send-keys -X copy-selection-and-cancel
bind [ copy-mode

# Quick search for "error" in history
bind-key e copy-mode \; send-keys "?error" C-m

# Better mouse wheel behavior
bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" \
  "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'select-pane -t=; copy-mode -e; send-keys -M'"
bind -n WheelDownPane select-pane -t= \; send-keys -M
bind -n C-WheelUpPane select-pane -t= \; copy-mode -e \; send-keys -M
bind -T copy-mode-vi C-WheelUpPane   send-keys -X halfpage-up
bind -T copy-mode-vi C-WheelDownPane send-keys -X halfpage-down

#######################
### LAYOUT SHORTCUTS ###
#######################

bind M-1 select-layout even-horizontal
bind M-2 select-layout even-vertical
bind M-3 select-layout main-horizontal
bind M-4 select-layout main-vertical
bind M-5 select-layout tiled

#######################
### DESIGN CHANGES ####
#######################

# Panes
set -g pane-border-style        bg=colour235,fg=colour238
set -g pane-active-border-style bg=colour236,fg=colour51

# Statusbar
set -g status-position bottom
set -g status-bg colour234
set -g status-fg colour137
set -g status-style dim
set -g status-justify left
set -g status-left-length 30
set -g status-right-length 50
set -g status-left '#[fg=green,bold](#S) #[fg=cyan]#(whoami)@#h '
set -g status-right '#[fg=colour233,bg=colour241,bold] %d/%m #[fg=colour233,bg=colour245,bold] %H:%M:%S '

# Window status
setw -g window-status-current-style  fg=colour81,bg=colour238,bold
setw -g window-status-current-format ' #I#[fg=colour250]:#[fg=colour255]#W#[fg=colour50]#F '
setw -g window-status-style          fg=colour138,bg=colour235,none
setw -g window-status-format         ' #I#[fg=colour237]:#[fg=colour250]#W#[fg=colour244]#F '
setw -g window-status-bell-style     fg=colour255,bg=colour1,bold

# Messages / modes
set -g message-style         fg=colour232,bg=colour166,bold
set -g message-command-style fg=blue,bg=black
setw -g mode-style           fg=colour0,bg=colour6
setw -g clock-mode-colour    colour135

# Quiet activity
set -g visual-activity off
set -g visual-bell off
set -g visual-silence off
setw -g monitor-activity off
set -g bell-action none

#######################
### HELP ##############
#######################

bind-key ? split-window -h 'exec tmux list-keys | less'

#######################
### PLUGINS (optional)
#######################
# set -g @plugin 'tmux-plugins/tpm'
# run '~/.tmux/plugins/tpm/tpm'

